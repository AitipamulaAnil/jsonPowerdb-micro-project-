<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Enrollment Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://login2explore.com/jpdb/resources/js/0.0.3/jpdb-commons.js"></script>
</head>
<body>
<div class="container">
    <h2>Student Enrollment Form</h2>
    <form id="studentform" method="post">
        <div class="form-group">
            <label for="rollNo">Roll No:</label>
            <input type="text" class="form-control" id="rollNo" placeholder="Enter Roll No" required>
        </div>
        <div class="form-group">
            <label for="fullName">Full Name:</label>
            <input type="text" class="form-control" id="fullName" placeholder="Enter Full Name" required>
        </div>
        <div class="form-group">
            <label for="class">Class:</label>
            <input type="text" class="form-control" id="class" placeholder="Enter Class" required>
        </div>
        <div class="form-group">
            <label for="birthDate">Birth Date:</label>
            <input type="date" class="form-control" id="birthDate" required>
        </div>
        <div class="form-group">
            <label for="address">Address:</label>
            <input type="text" class="form-control" id="address" placeholder="Enter Address" required>
        </div>
        <div class="form-group">
            <label for="enrollmentDate">Enrollment Date:</label>
            <input type="date" class="form-control" id="enrollmentDate" required>
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-primary" id="saveBtn" onclick="saveOrUpdateData('save');">Save</button>
            <button type="button" class="btn btn-primary" id="updateBtn" onclick="saveOrUpdateData('update');" disabled>Update</button>
            <button type="button" class="btn btn-primary" id="resetBtn" onclick="resetForm();">Reset</button>
        </div>
    </form>
</div>

<script>
    // Function to validate and get form data as JSON string
    function validateAndGetFormData() {
        var rollNo = $("#rollNo").val().trim();
        var fullName = $("#fullName").val().trim();
        var classVal = $("#class").val().trim();
        var birthDate = $("#birthDate").val().trim();
        var address = $("#address").val().trim();
        var enrollmentDate = $("#enrollmentDate").val().trim();

        if (rollNo === "" || fullName === "" || classVal === "" || birthDate === "" || address === "" || enrollmentDate === "") {
            alert("All fields are required.");
            return "";
        }

        var formData = {
            "Roll-No": rollNo,
            "Full-Name": fullName,
            "Class": classVal,
            "Birth-Date": birthDate,
            "Address": address,
            "Enrollment-Date": enrollmentDate
        };

        return JSON.stringify(formData);
    }

    // Function to reset the form
    function resetForm() {
        $("#rollNo").val("");
        $("#fullName").val("");
        $("#class").val("");
        $("#birthDate").val("");
        $("#address").val("");
        $("#enrollmentDate").val("");
        $("#saveBtn").prop("disabled", false);
        $("#updateBtn").prop("disabled", true);
        $("#rollNo").prop("disabled", false);
        $("#rollNo").focus();
    }

    // Function to save or update data
    function saveOrUpdateData(action) {
        var formData = validateAndGetFormData();
        if (formData === "") {
            return;
        }

        var putReqStr = createPUTRequest("90932197|-31949215865547720|90963498", formData, "SCHOOL-DB", "STUDENT-TABLE");
        var updateReqStr = createUPDATECommand("90932197|-31949215865547720|90963498", formData, "SCHOOL-DB", "STUDENT-TABLE");

        if (action === 'save') {
            console.log("PUT Request String:", putReqStr);
            executePutRequest(putReqStr);
        } else if (action === 'update') {
            console.log("UPDATE Request String:", updateReqStr);
            executeUpdateRequest(updateReqStr);
        }
    }

    // Function to execute PUT request
    function executePutRequest(putReqStr) {
        jQuery.ajaxSetup({ async: false });
        var resultObj = executeCommandAtGivenBaseUrl(putReqStr, "http://api.login2explore.com:5577", "/api/iml");
        jQuery.ajaxSetup({ async: true });

        console.log("PUT Result:", resultObj);
        if (resultObj.status === 200) {
            alert("Data saved successfully!");
            resetForm();
        } else {
            alert("Failed to save data. Please try again.");
        }
    }

    // Function to execute UPDATE request
    function executeUpdateRequest(updateReqStr) {
        jQuery.ajaxSetup({ async: false });
        var resultObj = executeCommandAtGivenBaseUrl(updateReqStr, "http://api.login2explore.com:5577", "/api/iml");
        jQuery.ajaxSetup({ async: true });

        console.log("UPDATE Result:", resultObj);
        if (resultObj.status === 200) {
            alert("Data updated successfully!");
            resetForm();
        } else {
            alert("Failed to update data. Please try again.");
        }
    }
</script>

</body>
</html>
